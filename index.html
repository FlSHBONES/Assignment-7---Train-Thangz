<!DOCTYPE html>

<html lang="en-us">

<head>

    <meta charset="UTF-8">
    <title>Employee Tracker</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <!-- Firebase Reference -->
    <script src="https://www.gstatic.com/firebasejs/5.5.0/firebase.js"></script>

    <!-- Moment.js Reference -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>

    <style>
        #train-table th,
    td {
      display: inline-block;
      width: 16.575%;
    }

    }

  </style>
</head>

<body>

    <!-- Employee Tracker -->
    <div class="container">

        <!-- Jumbotron -->
        <div class="jumbotron" style="background-color: sienna; color: white">
            <h1 class="text-center">Anytime is Train Time</h1>
            <h3 class="text-center">Choo Choo. Chee Chee.</h3>
        </div>



        <div class="row">

            <div class="col-md-12">
                <div class="card mb-4">
                    <div class="card-body">
                        Current Train Schedule
                        <table class="table table-sm table-hover" id='train-table'>
                            <thead>
                                <tr>
                                    <th scope="col">Train Name</th>
                                    <th scope="col">Destination</th>
                                    <th scope="col">Frequency (min)</th>
                                    <th scope="col">Next Arrival</th>
                                    <th scope="col">Minutes Away</th>
                                    <th scope="col">Total Billed ($)</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-md-12">
            <!-- Add Employee  -->
            <div class="card mb-4 p-4">
                <div class="card-body">
                    Add Train
                    <!-- Entry Form -->
                    <form>
                        <div class="form-group row">
                            <label for="train-name-input">Train Name</label>
                            <input class="form-control" id="train-name-input" placeholder="Jane Doe" type="text">
                        </div>
                        <div class="form-group row">
                            <label for="role-input">Role</label>
                            <input class="form-contr
              ol" id="role-input" placeholder="CEO" type="text">
                        </div>
                        <div class="form-group row">
                            <label for="start-input">Start Date (MM/DD/YYYY)</label>
                            <input class="form-control" id="start-input" placeholder="01/08/1989" type="text">
                        </div>
                        <div class="form-group row">
                            <label for="rate-input">Monthly Rate</label>
                            <input class="form-control" id="rate-input" placeholder="200000" type="text">
                        </div>
                        <button class="btn btn-primary float-right" id="add-train-btn">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- JavaScript -->
    <!-- <script src="script.js"></script> -->

    <script>
        var config = {
            apiKey: "AIzaSyBjy7xhl01bwDCEESljbdpNF4GRbEXBIvI",
            authDomain: "assignment6-f0f0a.firebaseapp.com",
            databaseURL: "https://assignment6-f0f0a.firebaseio.com",
            projectId: "assignment6-f0f0a",
            storageBucket: "assignment6-f0f0a.appspot.com"
        };

        firebase.initializeApp(config);

        var database = firebase.database();

        // 2. Button for train additions
        $("#add-train-btn").on("click", function (event) {
            event.preventDefault();

            // Grabs user input
            var trainName = $("#train-name-input").val().trim();
            var empRole = $("#role-input").val().trim();
            var empStart = moment($("#start-input").val().trim(), "MM/DD/YYYY").format("X");
            var empRate = $("#rate-input").val().trim();

            // Creates local "temporary" object for holding employee data
            var newEmp = {
                name: trainName,
                role: empRole,
                start: empStart,
                rate: empRate
            };

            // Uploads employee data to the database
            database.ref().push(newEmp);

            // Logs everything to console
            console.log(newEmp.name);
            console.log(newEmp.role);
            console.log(newEmp.start);
            console.log(newEmp.rate);

            alert("Employee successfully added");

            // Clears all of the text-boxes
            $("#train-name-input").val("");
            $("#role-input").val("");
            $("#start-input").val("");
            $("#rate-input").val("");
        });

        // 3. Create Firebase event for adding employee to the database and a row in the html when a user adds an entry
        database.ref().on("child_added", function (childSnapshot) {
            console.log(childSnapshot.val());

            // Store everything into a variable.
            var trainName = childSnapshot.val().name;
            var empRole = childSnapshot.val().role;
            var empStart = childSnapshot.val().start;
            var empRate = childSnapshot.val().rate;

            // Employee Info
            console.log(trainName);
            console.log(empRole);
            console.log(empStart);
            console.log(empRate);

            // Prettify the employee start
            var empStartPretty = moment.unix(empStart).format("MM/DD/YYYY");

            // Calculate the months worked using hardcore math
            // To calculate the months worked
            var empMonths = moment().diff(moment(empStart, "X"), "months");
            console.log(empMonths);

            // Calculate the total billed rate
            var empBilled = empMonths * empRate;
            console.log(empBilled);

            // Create the new row
            var newRow = $("<tr>").append(
                $("<td>").text(trainName),
                $("<td>").text(empRole),
                $("<td>").text(empStartPretty),
                $("<td>").text(empMonths),
                $("<td>").text(empRate),
                $("<td>").text(empBilled)
            );

            // Append the new row to the table
            $("#train-table > tbody").append(newRow);
        });

    </script>
</body>

</html>